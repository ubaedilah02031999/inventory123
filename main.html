<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Inventory Barang</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Main Application Section -->
    <div id="mainApp">
        <!-- Header -->
        <header class="bg-white shadow-lg">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-boxes text-white"></i>
                        </div>
                        <h1 class="text-2xl font-bold text-gray-800">Sistem Inventory Barang</h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span class="text-gray-700">Selamat datang, <span class="font-semibold">Pengguna</span></span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="bg-blue-600 text-white">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex space-x-2 py-4">
                    <button onclick="showSection('dashboard')" 
                            class="nav-btn px-4 py-2 rounded-lg bg-blue-700 hover:bg-blue-800 transition duration-300">
                        <i class="fas fa-home mr-2"></i>Dashboard
                    </button>
                    <button onclick="showSection('addItem')" 
                            class="nav-btn px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-300">
                        <i class="fas fa-plus mr-2"></i>Tambah Barang
                    </button>
                    <button onclick="showSection('stockList')" 
                            class="nav-btn px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-300">
                        <i class="fas fa-list mr-2"></i>Daftar Stok
                    </button>
                    <button onclick="showSection('transactionHistory')" 
                            class="nav-btn px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-300">
                        <i class="fas fa-history mr-2"></i>Riwayat
                    </button>
                    <button onclick="showSection('stockCard')" 
                            class="nav-btn px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-300">
                        <i class="fas fa-id-card mr-2"></i>Kartu Stok
                    </button>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Dashboard Section -->
            <div id="dashboard" class="section">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-xl shadow-md p-6 card-hover">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mr-4">
                                <i class="fas fa-boxes text-blue-600 text-xl"></i>
                            </div>
                            <div>
                                <p class="text-gray-600 text-sm">Total Barang</p>
                                <h2 class="text-2xl font-bold text-gray-800" id="totalItems">0</h2>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-md p-6 card-hover">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mr-4">
                                <i class="fas fa-warehouse text-green-600 text-xl"></i>
                            </div>
                            <div>
                                <p class="text-gray-600 text-sm">Total Stok</p>
                                <h2 class="text-2xl font-bold text-gray-800" id="totalStock">0</h2>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-md p-6 card-hover">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center mr-4">
                                <i class="fas fa-exchange-alt text-orange-600 text-xl"></i>
                            </div>
                            <div>
                                <p class="text-gray-600 text-sm">Total Transaksi</p>
                                <h2 class="text-2xl font-bold text-gray-800" id="totalTransactions">0</h2>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-md p-6 card-hover">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center mr-4">
                                <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
                            </div>
                            <div>
                                <p class="text-gray-600 text-sm">Stok Menipis</p>
                                <h2 class="text-2xl font-bold text-gray-800" id="lowStockItems">0</h2>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Barang Terbaru</h3>
                        <div id="recentItems" class="space-y-3">
                            <p class="text-gray-500 text-center">Belum ada barang</p>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Aktivitas Terbaru</h3>
                        <div id="recentActivities" class="space-y-3">
                            <p class="text-gray-500 text-center">Belum ada aktivitas</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Add Item Section -->
            <div id="addItem" class="section hidden">
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Tambah Barang Baru</h2>
                    <form id="addItemForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Kode Barang</label>
                            <input type="text" id="itemCode" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                   placeholder="BRG001" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nama Barang</label>
                            <input type="text" id="itemName" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                   placeholder="Nama barang" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Kategori</label>
                            <select id="itemCategory" 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="elektronik">Elektronik</option>
                                <option value="perkakas">Perkakas</option>
                                <option value="bahan">Bahan</option>
                                <option value="lainnya">Lainnya</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Stok Awal</label>
                            <input type="number" id="initialStock" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                   min="0" value="0" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Satuan</label>
                            <input type="text" id="itemUnit" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                   placeholder="pcs, kg, meter" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Harga Satuan</label>
                            <input type="number" id="itemPrice" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                   min="0" placeholder="0" required>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Deskripsi</label>
                            <textarea id="itemDescription" 
                                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                      rows="3" placeholder="Deskripsi barang"></textarea>
                        </div>
                        <div class="md:col-span-2">
                            <button type="submit" 
                                    class="bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition duration-300">
                                <i class="fas fa-save mr-2"></i>Simpan Barang
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Stock List Section -->
            <div id="stockList" class="section hidden">
                <div class="bg-white rounded-xl shadow-md p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">Daftar Stok Barang</h2>
                        <div class="flex space-x-4">
                            <input type="text" id="searchStock" 
                                   class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                   placeholder="Cari barang..." oninput="loadStockItems()">
                            <button onclick="exportStock()" 
                                    class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition duration-300">
                                <i class="fas fa-download mr-2"></i>Export
                            </button>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full table-auto">
                            <thead>
                                <tr class="bg-gray-50">
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kode</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Barang</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kategori</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Stok</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Satuan</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Harga</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="stockTableBody" class="bg-white divide-y divide-gray-200">
                                <!-- Stock data will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Transaction History Section -->
                    <div id="transactionHistory" class="section hidden">
            <div class="bg-white rounded-xl shadow-md p-6">
                <div class="flex justify-between items-center mb-6 flex-wrap">
    <h2 class="text-xl font-bold text-gray-800 text-sm sm:text-base mb-2 sm:mb-0">Riwayat Transaksi Barang</h2>
    <div class="flex space-x-1 sm:space-x-2 flex-wrap">
        <input type="date" id="filterDate" 
               class="px-2 py-1 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-xs sm:text-sm">

        <button onclick="filterTransactions()" 
                class="bg-blue-600 text-white px-2 py-1 rounded-lg hover:bg-blue-700 transition duration-300 text-xs sm:text-sm">
            <i class="fas fa-filter mr-1 sm:mr-2 text-xs sm:text-sm"></i>Filter
        </button>

        <button onclick="downloadExcel('transactionTableBody','riwayat_transaksi.xlsx')" 
                class="bg-green-600 text-white px-2 py-1 rounded-lg hover:bg-green-700 transition duration-300 text-xs sm:text-sm">
            <i class="fas fa-file-excel mr-1 sm:mr-2 text-xs sm:text-sm"></i>Excel
        </button>

        <button onclick="downloadPDF('#transactionHistory .overflow-x-auto','riwayat_transaksi.pdf')" 
                class="bg-red-600 text-white px-2 py-1 rounded-lg hover:bg-red-700 transition duration-300 text-xs sm:text-sm">
            <i class="fas fa-file-pdf mr-1 sm:mr-2 text-xs sm:text-sm"></i>PDF
        </button>
    </div>
</div>
>
                <div class="overflow-x-auto">
                    <table class="w-full table-auto">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kode Barang</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Barang</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Jumlah</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Keterangan</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tipe</th>
                            </tr>
                        </thead>
                        <tbody id="transactionTableBody" class="bg-white divide-y divide-gray-200">
                            <!-- Transaction data will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

            <!-- Stock Card Section -->
            <div id="stockCard" class="section hidden">
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Kartu Stok Barang</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Pilih Barang</label>
                            <select id="stockCardItem" 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                    onchange="loadStockCard()">
                                <option value="">-- Pilih Barang --</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Periode</label>
                            <div class="flex space-x-2">
                                <input type="date" id="startDate" class="flex-1 px-4 py-3 border border-gray-300 rounded-lg">
                                <input type="date" id="endDate" class="flex-1 px-4 py-3 border border-gray-300 rounded-lg">
                                <button onclick="loadStockCard()" 
                                        class="bg-blue-600 text-white px-4 py-3 rounded-lg hover:bg-blue-700 transition duration-300">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div id="stockCardContent" class="overflow-x-auto">
                        <p class="text-gray-500 text-center">Pilih barang untuk melihat kartu stok</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
            
            function downloadExcel() {
                let table = document.getElementById("transactionTableBody").parentElement;
                let wb = XLSX.utils.table_to_book(table, {sheet: "Riwayat"});
                XLSX.writeFile(wb, "riwayat_transaksi.xlsx");
            }

            function downloadPDF() {
                let element = document.querySelector("#transactionHistory .overflow-x-auto");
                let opt = {
                    margin: 0.3,
                    filename: "riwayat_transaksi.pdf",
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { scale: 2 },
                    jsPDF: { unit: 'in', format: 'a4', orientation: 'landscape' }
                };
                html2pdf().from(element).set(opt).save();
            }

        // Data storage
        let items = JSON.parse(localStorage.getItem('inventory_items')) || [];
        let transactions = JSON.parse(localStorage.getItem('inventory_transactions')) || [];
        const currentUser = { name: 'Pengguna' };

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Aplikasi Inventory dimuat...');
            
            // Add item form handler
            document.getElementById('addItemForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addNewItem();
            });

            // Initialize dashboard
            updateDashboard();
            loadStockItems();
            loadTransactions();
            populateItemDropdown();

            // Pre-fill today's date for filters
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('filterDate').value = today;
            document.getElementById('startDate').value = today;
            document.getElementById('endDate').value = today;
        });

        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });

            // Show selected section
            const sectionElement = document.getElementById(sectionName);
            if (sectionElement) {
                sectionElement.classList.remove('hidden');
            }

            // Update navigation buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('bg-blue-700');
            });
            
            // Find the button that was clicked and highlight it
            const buttons = document.querySelectorAll('.nav-btn');
            for (let btn of buttons) {
                if (btn.textContent.includes(sectionName.replace(/([A-Z])/g, ' $1').trim())) {
                    btn.classList.add('bg-blue-700');
                    break;
                }
            }

            // Refresh section data if needed
            if (sectionName === 'dashboard') updateDashboard();
            if (sectionName === 'stockList') loadStockItems();
            if (sectionName === 'transactionHistory') loadTransactions();
            if (sectionName === 'stockCard') populateItemDropdown();
        }

        function addNewItem() {
            const code = document.getElementById('itemCode').value.trim();
            const name = document.getElementById('itemName').value.trim();
            const stock = parseInt(document.getElementById('initialStock').value);
            const unit = document.getElementById('itemUnit').value.trim();
            const price = parseFloat(document.getElementById('itemPrice').value);

            // Validation
            if (!code || !name || isNaN(stock) || stock < 0 || !unit || isNaN(price) || price < 0) {
                alert('Harap isi semua field dengan benar!');
                return;
            }

            const newItem = {
                id: Date.now().toString(),
                code: code,
                name: name,
                category: document.getElementById('itemCategory').value,
                stock: stock,
                unit: unit,
                price: price,
                description: document.getElementById('itemDescription').value.trim(),
                createdAt: new Date().toISOString()
            };

            items.push(newItem);
            localStorage.setItem('inventory_items', JSON.stringify(items));

            // Add initial stock transaction
            const transaction = {
                id: Date.now().toString(),
                itemId: newItem.id,
                itemCode: newItem.code,
                itemName: newItem.name,
                type: 'in',
                quantity: newItem.stock,
                description: 'Stok awal',
                timestamp: new Date().toISOString()
            };
            transactions.push(transaction);
            localStorage.setItem('inventory_transactions', JSON.stringify(transactions));

            // Reset form
            document.getElementById('addItemForm').reset();
            alert('Barang berhasil ditambahkan!');
            showSection('dashboard');
        }

        function updateDashboard() {
            // Update statistics
            document.getElementById('totalItems').textContent = items.length;
            document.getElementById('totalStock').textContent = items.reduce((sum, item) => sum + item.stock, 0);
            document.getElementById('totalTransactions').textContent = transactions.length;
            document.getElementById('lowStockItems').textContent = items.filter(item => item.stock < 10).length;

            // Show recent items
            const recentItemsContainer = document.getElementById('recentItems');
            const recentItems = items.slice(-5).reverse();
            
            if (recentItems.length === 0) {
                recentItemsContainer.innerHTML = '<p class="text-gray-500 text-center">Belum ada barang</p>';
            } else {
                recentItemsContainer.innerHTML = recentItems.map(item => `
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <div>
                            <p class="font-medium text-gray-800">${item.name}</p>
                            <p class="text-sm text-gray-600">${item.code} • Stok: ${item.stock} ${item.unit}</p>
                        </div>
                        <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full capitalize">${item.category}</span>
                    </div>
                `).join('');
            }

            // Show recent activities
            const recentActivitiesContainer = document.getElementById('recentActivities');
            const recentActivities = transactions.slice(-5).reverse();
            
            if (recentActivities.length === 0) {
                recentActivitiesContainer.innerHTML = '<p class="text-gray-500 text-center">Belum ada aktivitas</p>';
            } else {
                recentActivitiesContainer.innerHTML = recentActivities.map(transaction => {
                    const item = items.find(i => i.id === transaction.itemId);
                    return `
                    <div class="flex items-center p-3 bg-gray-50 rounded-lg">
                        <div class="w-8 h-8 rounded-full bg-${transaction.type === 'in' ? 'green' : 'red'}-100 flex items-center justify-center mr-3">
                            <i class="fas fa-${transaction.type === 'in' ? 'plus' : 'minus'} text-${transaction.type === 'in' ? 'green' : 'red'}-600 text-xs"></i>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-800">${transaction.itemName}</p>
                            <p class="text-xs text-gray-600">${new Date(transaction.timestamp).toLocaleDateString('id-ID')} • ${transaction.quantity} ${item ? item.unit : ''}</p>
                        </div>
                    </div>
                `}).join('');
            }
        }

        function loadStockItems() {
            const tbody = document.getElementById('stockTableBody');
            const searchTerm = document.getElementById('searchStock').value.toLowerCase();
            
            const filteredItems = items.filter(item => 
                item.name.toLowerCase().includes(searchTerm) ||
                item.code.toLowerCase().includes(searchTerm) ||
                item.category.toLowerCase().includes(searchTerm)
            );

            if (filteredItems.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="px-6 py-4 text-center text-gray-500">Tidak ada data barang</td></tr>';
                return;
            }

            tbody.innerHTML = filteredItems.map(item => `
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.code}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 capitalize">${item.category}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 ${item.stock < 5 ? 'text-red-600 font-semibold' : ''}">${item.stock}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.unit}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Rp ${item.price.toLocaleString('id-ID')}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="adjustStock('${item.id}')" class="text-blue-600 hover:text-blue-900 mr-3">Rubah Stock</button>
                        <button onclick="deleteItem('${item.id}')" class="text-red-600 hover:text-red-900">Hapus</button>
                    </td>
                </tr>
            `).join('');
        }

        function adjustStock(itemId) {
            const item = items.find(i => i.id === itemId);
            if (!item) return;

            const adjustment = prompt(`Adjust stok ${item.name} (${item.stock} ${item.unit}):\nMasukkan perubahan stok (positif untuk tambah, negatif untuk kurangi)`, '0');
            
            if (adjustment === null) return;
            
            const change = parseInt(adjustment);
            if (isNaN(change)) {
                alert('Masukkan angka yang valid!');
                return;
            }

            if (item.stock + change < 0) {
                alert('Stok tidak boleh negatif!');
                return;
            }

            item.stock += change;
            localStorage.setItem('inventory_items', JSON.stringify(items));

            // Record transaction
            const transaction = {
                id: Date.now().toString(),
                itemId: item.id,
                itemCode: item.code,
                itemName: item.name,
                type: change > 0 ? 'in' : 'out',
                quantity: Math.abs(change),
                description: change > 0 ? 'Penambahan stok' : 'Pengurangan stok',
                timestamp: new Date().toISOString()
            };
            transactions.push(transaction);
            localStorage.setItem('inventory_transactions', JSON.stringify(transactions));

            alert('Stok berhasil diupdate!');
            loadStockItems();
            updateDashboard();
        }

        function deleteItem(itemId) {
            if (!confirm('Apakah Anda yakin ingin menghapus barang ini?')) return;
            
            items = items.filter(item => item.id !== itemId);
            localStorage.setItem('inventory_items', JSON.stringify(items));
            
            // Also remove related transactions
            transactions = transactions.filter(t => t.itemId !== itemId);
            localStorage.setItem('inventory_transactions', JSON.stringify(transactions));
            
            alert('Barang berhasil dihapus!');
            loadStockItems();
            updateDashboard();
        }

        function loadTransactions() {
            const tbody = document.getElementById('transactionTableBody');
            const filterDate = document.getElementById('filterDate').value;
            
            let filteredTransactions = transactions;
            if (filterDate) {
                filteredTransactions = transactions.filter(t => 
                    t.timestamp.split('T')[0] === filterDate
                );
            }

            if (filteredTransactions.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="px-6 py-4 text-center text-gray-500">Tidak ada data transaksi</td></tr>';
                return;
            }

            tbody.innerHTML = filteredTransactions.map(transaction => {
                const item = items.find(i => i.id === transaction.itemId);
                return `
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${new Date(transaction.timestamp).toLocaleDateString('id-ID')}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${transaction.itemCode}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${transaction.itemName}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 ${transaction.type === 'in' ? 'text-green-600' : 'text-red-600'}">
                        ${transaction.type === 'in' ? '+' : '-'}${transaction.quantity}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${transaction.description}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 capitalize">${transaction.type === 'in' ? 'Masuk' : 'Keluar'}</td>
                </tr>
            `}).join('');
        }

        function filterTransactions() {
            loadTransactions();
        }

        function populateItemDropdown() {
            const select = document.getElementById('stockCardItem');
            select.innerHTML = '<option value="">-- Pilih Barang --</option>' +
                items.map(item => `<option value="${item.id}">${item.code} - ${item.name}</option>`).join('');
        }

        function loadStockCard() {
            const itemId = document.getElementById('stockCardItem').value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;

            if (!itemId) {
                document.getElementById('stockCardContent').innerHTML = '<p class="text-gray-500 text-center">Pilih barang untuk melihat kartu stok</p>';
                return;
            }

            const item = items.find(i => i.id === itemId);
            let filteredTransactions = transactions.filter(t => t.itemId === itemId);

            if (startDate && endDate) {
                filteredTransactions = filteredTransactions.filter(t => {
                    const transDate = t.timestamp.split('T')[0];
                    return transDate >= startDate && transDate <= endDate;
                });
            }

            document.getElementById('stockCardContent').innerHTML = `
                <div class="mb-6 p-4 bg-blue-50 rounded-lg">
                    <h3 class="text-lg font-semibold text-blue-800 mb-2">Informasi Barang</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div>
                            <p class="text-sm text-blue-600">Kode</p>
                            <p class="font-medium">${item.code}</p>
                        </div>
                        <div>
                            <p class="text-sm text-blue-600">Nama</p>
                            <p class="font-medium">${item.name}</p>
                        </div>
                        <div>
                            <p class="text-sm text-blue-600">Stok Akhir</p>
                            <p class="font-medium ${item.stock < 5 ? 'text-red-600' : 'text-green-600'}">${item.stock} ${item.unit}</p>
                        </div>
                        <div>
                            <p class="text-sm text-blue-600">Kategori</p>
                            <p class="font-medium capitalize">${item.category}</p>
                        </div>
                    </div>
                </div>

                <div class="overflow-x-auto">
                    <table class="w-full table-auto">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Keterangan</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Masuk</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Keluar</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Saldo</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${filteredTransactions.map((trans, index) => {
                                const balance = filteredTransactions.slice(0, index + 1).reduce((sum, t) => {
                                    return sum + (t.type === 'in' ? t.quantity : -t.quantity);
                                }, 0);
                                
                                return `
                                    <tr class="border-b border-gray-200">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${new Date(trans.timestamp).toLocaleDateString('id-ID')}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${trans.description}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-green-600">${trans.type === 'in' ? trans.quantity : '-'}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-red-600">${trans.type === 'out' ? trans.quantity : '-'}</td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${balance}</td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function exportStock() {
            // Simple export function - could be enhanced with CSV download
            const stockData = items.map(item => ({
                Kode: item.code,
                Nama: item.name,
                Kategori: item.category,
                Stok: item.stock,
                Satuan: item.unit,
                Harga: item.price
            }));
            
            console.table(stockData);
            alert('Data stok telah diexport ke console (F12 untuk melihat)');
        }
    </script>
</body>
</html>
